<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Center - CarbonTrack</title>
  <link rel="icon" href="/img/team.jpg" type="image/JPG">
  <!-- 将Bootstrap改为CDN引用 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
  <!-- 引入iOS设计风格CSS -->
  <link rel="stylesheet" href="./css/ios-design.css">
  <link rel="stylesheet" href="./css/index.css">

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/nav.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- 页面特定的样式，补充ios-design.css中没有的样式 -->
  <style>
    /* 颜色变量定义 */
    :root {
      /* 基础颜色 */
      --text-color-light: #000;
      --text-color-dark: #fff;
      --bg-color-light: #F2F2F7;
      --bg-color-dark: #1C1C1E;
      --card-bg-light: rgba(255, 255, 255, 0.8);
      --card-bg-dark: rgba(44, 44, 46, 0.8);
      --border-color-light: #d1d1d6;
      --border-color-dark: #3a3a3c;
      
      /* 主题色 */
      --ios-blue-light: #007AFF;
      --ios-blue-dark: #0A84FF;
      --ios-purple-light: #5856D6;
      --ios-purple-dark: #5E5CE6;
      
      /* 辅助色 */
      --muted-text-light: #8E8E93;
      --muted-text-dark: #98989D;
      --highlight-bg-light: rgba(0, 122, 255, 0.1);
      --highlight-bg-dark: rgba(10, 132, 255, 0.2);
    }
    
    /* 基础样式 */
    body {
      background-color: var(--bg-color-light);
      color: var(--text-color-light);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    
    /* 暗色模式样式 */
    body.dark-theme,
    body.auto-theme.dark-mode {
      background-color: var(--bg-color-dark);
      color: var(--text-color-dark);
    }
    
    /* 用户信息卡片样式调整 */
    .info-card {
      border-radius: 20px;
      border: none;
      background-color: var(--card-bg-light);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.06);
      overflow: hidden;
      transition: transform 0.3s cubic-bezier(0.25, 0.1, 0.25, 1), 
                  box-shadow 0.3s cubic-bezier(0.25, 0.1, 0.25, 1),
                  background-color 0.3s ease;
      margin-bottom: 25px;
    }
    
    body.dark-theme .info-card,
    body.auto-theme.dark-mode .info-card {
      background-color: var(--card-bg-dark);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
    }
    
    .info-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.1);
    }
    
    body.dark-theme .info-card:hover,
    body.auto-theme.dark-mode .info-card:hover {
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.25);
    }
    
    /* 排名图标样式 */
    .rank-icon {
      display: inline-block;
      margin-right: 4px;
    }
    
    /* 前三名样式 */
    .rank-1 {
      background: linear-gradient(to right, rgba(255, 204, 0, 0.1), transparent 90%);
      font-weight: 700;
    }
    
    .rank-2 {
      background: linear-gradient(to right, rgba(142, 142, 147, 0.1), transparent 90%);
      font-weight: 600;
    }
    
    .rank-3 {
      background: linear-gradient(to right, rgba(52, 199, 89, 0.1), transparent 90%);
      font-weight: 500;
    }
    
    body.dark-theme .rank-1,
    body.auto-theme.dark-mode .rank-1 {
      background: linear-gradient(to right, rgba(255, 204, 0, 0.2), transparent 90%);
    }
    
    body.dark-theme .rank-2,
    body.auto-theme.dark-mode .rank-2 {
      background: linear-gradient(to right, rgba(142, 142, 147, 0.2), transparent 90%);
    }
    
    body.dark-theme .rank-3,
    body.auto-theme.dark-mode .rank-3 {
      background: linear-gradient(to right, rgba(52, 199, 89, 0.2), transparent 90%);
    }
    
    /* 当前用户高亮 */
    .table tbody tr.current-user {
      background-color: var(--highlight-bg-light);
      font-weight: 600;
    }
    
    body.dark-theme .table tbody tr.current-user,
    body.auto-theme.dark-mode .table tbody tr.current-user {
      background-color: var(--highlight-bg-dark);
    }
    
    /* 点数显示样式 */
    .info-value {
      font-weight: 600;
      color: var(--ios-blue-light);
      font-size: 1.1rem;
      display: inline-block;
      margin-left: 5px;
      position: relative;
      padding: 3px 12px;
      border-radius: 10px;
      background: var(--highlight-bg-light);
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    
    body.dark-theme .info-value,
    body.auto-theme.dark-mode .info-value {
      color: var(--ios-blue-dark);
      background: var(--highlight-bg-dark);
    }
    
    /* 信息标题样式 */
    .info-title {
      font-weight: 600;
      color: var(--muted-text-light);
      margin-bottom: 8px;
      position: relative;
      display: inline-block;
      transition: color 0.3s ease;
    }
    
    body.dark-theme .info-title,
    body.auto-theme.dark-mode .info-title {
      color: var(--muted-text-dark);
    }
    
    .info-title::after {
      content: '';
      position: absolute;
      bottom: -4px;
      left: 0;
      width: 30px;
      height: 2px;
      background: linear-gradient(to right, var(--ios-blue-light), var(--ios-purple-light));
      border-radius: 1px;
      transition: background 0.3s ease;
    }
    
    body.dark-theme .info-title::after,
    body.auto-theme.dark-mode .info-title::after {
      background: linear-gradient(to right, var(--ios-blue-dark), var(--ios-purple-dark));
    }
    
    /* 卡片文本 */
    .card-text {
      color: var(--text-color-light);
      transition: color 0.3s ease;
      margin-bottom: 16px;
    }
    
    body.dark-theme .card-text,
    body.auto-theme.dark-mode .card-text {
      color: var(--text-color-dark);
    }
    
    /* 按钮激活状态 */
    .btn-group .btn.active {
      background-color: var(--ios-blue-light) !important;
      color: white !important;
      box-shadow: 0 4px 12px rgba(0, 122, 255, 0.15);
    }
    
    body.dark-theme .btn-group .btn.active,
    body.auto-theme.dark-mode .btn-group .btn.active {
      background-color: var(--ios-blue-dark) !important;
      box-shadow: 0 4px 12px rgba(10, 132, 255, 0.25);
    }
    
    /* 按钮组样式美化 */
    .ios-btn-group {
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      margin-bottom: 20px;
      display: flex;
    }
    
    body.dark-theme .ios-btn-group,
    body.auto-theme.dark-mode .ios-btn-group {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    .ios-btn-group .btn {
      border: none;
      padding: 10px 20px;
      background-color: var(--card-bg-light);
      color: var(--muted-text-light);
      font-weight: 500;
      transition: all 0.3s cubic-bezier(0.25, 0.1, 0.25, 1);
      flex: 1;
      text-align: center;
    }
    
    body.dark-theme .ios-btn-group .btn,
    body.auto-theme.dark-mode .ios-btn-group .btn {
      background-color: var(--card-bg-dark);
      color: var(--muted-text-dark);
    }
    
    .ios-btn-group .btn:hover {
      background-color: var(--highlight-bg-light);
      color: var(--ios-blue-light);
    }
    
    body.dark-theme .ios-btn-group .btn:hover,
    body.auto-theme.dark-mode .ios-btn-group .btn:hover {
      background-color: var(--highlight-bg-dark);
      color: var(--ios-blue-dark);
    }
    
    .ios-btn-group .btn.active {
      background-color: var(--ios-blue-light);
      color: white;
    }
    
    body.dark-theme .ios-btn-group .btn.active,
    body.auto-theme.dark-mode .ios-btn-group .btn.active {
      background-color: var(--ios-blue-dark);
    }
    
    /* 历史记录按钮样式 */
    .history-btn {
      position: relative;
      right: 0;
      min-width: 200px; 
      padding: 12px 20px;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--ios-blue-light), var(--ios-purple-light));
      color: white;
      font-weight: 600;
      border: none;
      box-shadow: 0 6px 16px rgba(0, 122, 255, 0.2);
      transition: all 0.3s cubic-bezier(0.25, 0.1, 0.25, 1);
      margin-right: 0;
      text-align: center;
      overflow: hidden;
    }
    
    body.dark-theme .history-btn,
    body.auto-theme.dark-mode .history-btn {
      background: linear-gradient(135deg, var(--ios-blue-dark), var(--ios-purple-dark));
      box-shadow: 0 6px 16px rgba(10, 132, 255, 0.3);
    }
    
    .history-btn::before {
      content: '';
      position: absolute;
      top: -10px;
      left: -10px;
      right: -10px;
      bottom: -10px;
      background: linear-gradient(135deg, rgba(255,255,255,0.1), transparent);
      transform: rotate(45deg) translateX(-200%);
      transition: transform 0.5s cubic-bezier(0.25, 0.1, 0.25, 1);
    }
    
    .history-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0, 122, 255, 0.25);
      color: white;
    }
    
    body.dark-theme .history-btn:hover,
    body.auto-theme.dark-mode .history-btn:hover {
      box-shadow: 0 8px 25px rgba(10, 132, 255, 0.35);
    }
    
    .history-btn:hover::before {
      transform: rotate(45deg) translateX(200%);
    }
    
    /* 排行榜表格样式 */
    .leaderboard-table {
      background-color: var(--card-bg-light);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.06);
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
    }
    
    body.dark-theme .leaderboard-table,
    body.auto-theme.dark-mode .leaderboard-table {
      background-color: var(--card-bg-dark);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
    }
    
    .leaderboard-table thead th {
      border-top: none;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
      color: var(--muted-text-light);
      font-weight: 600;
      padding: 16px;
      transition: color 0.3s ease, border-color 0.3s ease;
    }
    
    body.dark-theme .leaderboard-table thead th,
    body.auto-theme.dark-mode .leaderboard-table thead th {
      border-bottom-color: rgba(255, 255, 255, 0.1);
      color: var(--ios-blue-dark);
    }
    
    .leaderboard-table tbody tr {
      transition: background-color 0.3s ease, color 0.3s ease;
      color: var(--text-color-light);
    }
    
    body.dark-theme .leaderboard-table tbody tr,
    body.auto-theme.dark-mode .leaderboard-table tbody tr {
      color: var(--text-color-dark);
    }
    
    .leaderboard-table tbody tr:hover {
      background-color: var(--highlight-bg-light);
    }
    
    body.dark-theme .leaderboard-table tbody tr:hover,
    body.auto-theme.dark-mode .leaderboard-table tbody tr:hover {
      background-color: var(--highlight-bg-dark);
    }
    
    /* 页面内容容器 */
    .content-container {
      padding: 25px;
      border-radius: 20px;
      background-color: var(--card-bg-light);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.06);
      margin-top: 25px;
      margin-bottom: 25px;
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
    }
    
    body.dark-theme .content-container,
    body.auto-theme.dark-mode .content-container {
      background-color: var(--card-bg-dark);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
    }
    
    /* 标题样式 */
    .ios-section-heading {
      font-weight: 700;
      margin-bottom: 25px;
      color: var(--text-color-light);
      position: relative;
      display: inline-block;
      transition: color 0.3s ease;
    }
    
    body.dark-theme .ios-section-heading,
    body.auto-theme.dark-mode .ios-section-heading {
      color: var(--text-color-dark);
    }
    
    .ios-section-heading::after {
      content: '';
      position: absolute;
      bottom: -8px;
      left: 0;
      width: 60px;
      height: 3px;
      background: linear-gradient(to right, var(--ios-blue-light), var(--ios-purple-light));
      border-radius: 1.5px;
      transition: background 0.3s ease;
    }
    
    body.dark-theme .ios-section-heading::after,
    body.auto-theme.dark-mode .ios-section-heading::after {
      background: linear-gradient(to right, var(--ios-blue-dark), var(--ios-purple-dark));
    }
    
    /* 添加动画效果 */
    .fade-in-up {
      animation: fadeInUp 0.6s cubic-bezier(0.25, 0.1, 0.25, 1) forwards;
      opacity: 0;
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* 添加延迟效果 */
    .delay-1 { animation-delay: 0.1s; }
    .delay-2 { animation-delay: 0.2s; }
    .delay-3 { animation-delay: 0.3s; }
    .delay-4 { animation-delay: 0.4s; }
    .delay-5 { animation-delay: 0.5s; }
    
    /* 霓虹效果 */
    .glow-effect {
      position: fixed;
      width: 300px;
      height: 300px;
      border-radius: 50%;
      filter: blur(50px);
      z-index: -1;
      animation: pulse 8s infinite alternate cubic-bezier(0.25, 0.1, 0.25, 1);
    }
    
    .glow-blue {
      top: 10%;
      right: 10%;
      background: radial-gradient(circle, rgba(0, 122, 255, 0.2), transparent 70%);
    }
    
    .glow-purple {
      bottom: 10%;
      left: 5%;
      background: radial-gradient(circle, rgba(88, 86, 214, 0.15), transparent 70%);
      animation-delay: 2s;
    }
    
    body.dark-theme .glow-blue,
    body.auto-theme.dark-mode .glow-blue {
      background: radial-gradient(circle, rgba(10, 132, 255, 0.2), transparent 70%);
    }
    
    body.dark-theme .glow-purple,
    body.auto-theme.dark-mode .glow-purple {
      background: radial-gradient(circle, rgba(94, 92, 230, 0.15), transparent 70%);
    }
    
    @keyframes pulse {
      0% { transform: scale(1) translate(0, 0); opacity: 0.5; }
      50% { transform: scale(1.05) translate(20px, -10px); opacity: 0.7; }
      100% { transform: scale(1) translate(0, 0); opacity: 0.5; }
    }
    
    /* 模态框样式 */
    .modal-content {
      background-color: var(--card-bg-light);
      border-radius: 16px;
      border: none;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      transition: background-color 0.3s ease;
    }
    
    body.dark-theme .modal-content,
    body.auto-theme.dark-mode .modal-content {
      background-color: var(--card-bg-dark);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
    }
    
    .modal-header, .modal-footer {
      border-color: var(--border-color-light);
      transition: border-color 0.3s ease;
    }
    
    body.dark-theme .modal-header,
    body.auto-theme.dark-mode .modal-header,
    body.dark-theme .modal-footer,
    body.auto-theme.dark-mode .modal-footer {
      border-color: var(--border-color-dark);
    }
    
    .modal-title {
      color: var(--text-color-light);
      transition: color 0.3s ease;
    }
    
    body.dark-theme .modal-title,
    body.auto-theme.dark-mode .modal-title {
      color: var(--text-color-dark);
    }
    
    .close {
      color: var(--text-color-light);
      text-shadow: none;
      opacity: 0.7;
      transition: color 0.3s ease, opacity 0.3s ease;
    }
    
    body.dark-theme .close,
    body.auto-theme.dark-mode .close {
      color: var(--text-color-dark);
    }
    
    .close:hover {
      opacity: 1;
    }
    
    /* 表单控件 */
    .form-control {
      background-color: var(--bg-color-light);
      border-color: var(--border-color-light);
      color: var(--text-color-light);
      border-radius: 10px;
      padding: 10px 15px;
      transition: all 0.3s ease;
    }
    
    .form-control:focus {
      box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.15);
      border-color: var(--ios-blue-light);
    }
    
    body.dark-theme .form-control,
    body.auto-theme.dark-mode .form-control {
      background-color: #3A3A3C;
      border-color: var(--border-color-dark);
      color: var(--text-color-dark);
    }
    
    body.dark-theme .form-control:focus,
    body.auto-theme.dark-mode .form-control:focus {
      box-shadow: 0 0 0 4px rgba(10, 132, 255, 0.25);
      border-color: var(--ios-blue-dark);
    }
    
    /* 表单标签 */
    .form-group label {
      color: var(--text-color-light);
      font-weight: 500;
      margin-bottom: 8px;
      transition: color 0.3s ease;
    }
    
    body.dark-theme .form-group label,
    body.auto-theme.dark-mode .form-group label {
      color: var(--text-color-dark);
    }
    
    /* 主题切换按钮 */
    .theme-toggle {
      position: fixed;
      right: 20px;
      bottom: 20px;
      width: 48px;
      height: 48px;
      border-radius: 24px;
      background-color: var(--card-bg-light);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      z-index: 1000;
      transition: all 0.3s ease;
    }
    
    body.dark-theme .theme-toggle,
    body.auto-theme.dark-mode .theme-toggle {
      background-color: #3a3a3c;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    }
    
    .theme-toggle i {
      font-size: 22px;
      color: var(--muted-text-light);
      transition: color 0.3s ease;
    }
    
    body.dark-theme .theme-toggle i,
    body.auto-theme.dark-mode .theme-toggle i {
      color: var(--text-color-dark);
    }
    
    /* 毛玻璃效果 */
    .frosted-glass {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: -2;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.05);
      transition: background-color 0.5s ease;
    }
    
    body.dark-theme .frosted-glass,
    body.auto-theme.dark-mode .frosted-glass {
      background: rgba(0, 0, 0, 0.05);
    }
    
    /* 设置文本高对比度 - 让黑夜模式更清晰可见 */
    body.dark-theme,
    body.auto-theme.dark-mode {
      --text-color-dark: #ffffff; /* 确保白色足够明亮 */
    }
    
    /* 优化移动设备排版 */
    @media (max-width: 768px) {
      .ios-btn-group {
        flex-direction: column;
      }
      
      .ios-btn-group .btn {
        border-radius: 0;
      }
      
      .ios-btn-group .btn:first-child {
        border-top-left-radius: 12px;
        border-top-right-radius: 12px;
      }
      
      .ios-btn-group .btn:last-child {
        border-bottom-left-radius: 12px;
        border-bottom-right-radius: 12px;
      }
      
      .history-btn {
        width: 100%;
        margin-top: 15px;
      }
      
      .content-container {
        padding: 20px 15px;
      }
    }
    
    /* iOS风格排行榜样式增强 */
    .leaderboard-section {
      margin-bottom: 30px;
    }
    
    /* iOS标准分段控制器 */
    .ios-segment-control {
      display: flex;
      background-color: rgba(120, 120, 128, 0.12);
      border-radius: 8px;
      padding: 2px;
      margin-bottom: 20px;
      max-width: 550px;
      margin-left: auto;
      margin-right: auto;
      position: relative;
      overflow: hidden;
      transition: background-color 0.3s ease;
    }
    
    body.dark-theme .ios-segment-control,
    body.auto-theme.dark-mode .ios-segment-control {
      background-color: rgba(120, 120, 128, 0.32);
    }
    
    .ios-segment-control .segment {
      flex: 1;
      text-align: center;
      padding: 8px 16px;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-color-light);
      border: none;
      background: transparent;
      position: relative;
      z-index: 1;
      transition: color 0.3s ease;
      outline: none;
      cursor: pointer;
    }
    
    body.dark-theme .ios-segment-control .segment,
    body.auto-theme.dark-mode .ios-segment-control .segment {
      color: var(--text-color-dark);
    }
    
    .ios-segment-control .segment.active {
      color: var(--text-color-light);
    }
    
    body.dark-theme .ios-segment-control .segment.active,
    body.auto-theme.dark-mode .ios-segment-control .segment.active {
      color: var(--text-color-dark);
    }
    
    .ios-segment-control .segment-selector {
      position: absolute;
      height: calc(100% - 4px);
      top: 2px;
      z-index: 0;
      border-radius: 6px;
      background-color: white;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.12);
      transition: transform 0.3s cubic-bezier(0.25, 0.1, 0.25, 1);
    }
    
    body.dark-theme .ios-segment-control .segment-selector,
    body.auto-theme.dark-mode .ios-segment-control .segment-selector {
      background-color: rgba(30, 30, 30, 0.8);
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
    }
    
    .ios-segment-control .segment i {
      margin-right: 6px;
      color: inherit;
      font-size: 13px;
    }
    
    /* iOS表格卡片样式 */
    .ios-card-table {
      border-radius: 12px;
      background-color: var(--card-bg-light);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      overflow: hidden;
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      margin-bottom: 20px;
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
    }
    
    body.dark-theme .ios-card-table,
    body.auto-theme.dark-mode .ios-card-table {
      background-color: var(--card-bg-dark);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    }
    
    /* 表格头部样式 */
    .ios-table-header {
      padding: 15px;
      border-bottom: 1px solid rgba(60, 60, 67, 0.1);
      display: flex;
      font-weight: 500;
      color: var(--muted-text-light);
      font-size: 13px;
      letter-spacing: -0.08px;
      transition: border-color 0.3s ease, color 0.3s ease;
    }
    
    body.dark-theme .ios-table-header,
    body.auto-theme.dark-mode .ios-table-header {
      border-bottom-color: rgba(84, 84, 88, 0.3);
      color: var(--muted-text-dark);
    }
    
    .ios-table-header .col-rank {
      width: 15%;
      padding-left: 5px;
    }
    
    .ios-table-header .col-user {
      width: 50%;
    }
    
    .ios-table-header .col-points {
      width: 35%;
      text-align: right;
      padding-right: 15px;
    }
    
    /* 表格内容样式 */
    .ios-table-row {
      display: flex;
      padding: 14px 15px;
      align-items: center;
      border-bottom: 1px solid rgba(60, 60, 67, 0.1);
      transition: background-color 0.2s ease, border-color 0.3s ease;
      color: var(--text-color-light);
    }
    
    .ios-table-row:last-child {
      border-bottom: none;
    }
    
    body.dark-theme .ios-table-row,
    body.auto-theme.dark-mode .ios-table-row {
      border-bottom-color: rgba(84, 84, 88, 0.3);
      color: var(--text-color-dark);
    }
    
    .ios-table-row:hover {
      background-color: rgba(0, 122, 255, 0.05);
    }
    
    body.dark-theme .ios-table-row:hover,
    body.auto-theme.dark-mode .ios-table-row:hover {
      background-color: rgba(10, 132, 255, 0.1);
    }
    
    .ios-table-row .col-rank {
      width: 15%;
      font-weight: 600;
      font-size: 15px;
      display: flex;
      align-items: center;
    }
    
    .ios-table-row .col-user {
      width: 50%;
      font-size: 16px;
      font-weight: 400;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .ios-table-row .col-points {
      width: 35%;
      text-align: right;
      font-size: 16px;
      font-weight: 600;
      color: var(--ios-blue-light);
      padding-right: 15px;
      transition: color 0.3s ease;
    }
    
    body.dark-theme .ios-table-row .col-points,
    body.auto-theme.dark-mode .ios-table-row .col-points {
      color: var(--ios-blue-dark);
    }
    
    /* 前三名特殊样式 */
    .ios-table-row.top-rank {
      position: relative;
    }
    
    .ios-table-row.top-rank::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      opacity: 0.1;
      pointer-events: none;
      z-index: 0;
      border-radius: 0 0 12px 12px;
      transition: opacity 0.3s ease;
    }
    
    body.dark-theme .ios-table-row.top-rank::before,
    body.auto-theme.dark-mode .ios-table-row.top-rank::before {
      opacity: 0.15;
    }
    
    .ios-table-row.rank-1::before {
      background: linear-gradient(to right, #FFD700, transparent 80%);
    }
    
    .ios-table-row.rank-2::before {
      background: linear-gradient(to right, #C0C0C0, transparent 80%);
    }
    
    .ios-table-row.rank-3::before {
      background: linear-gradient(to right, #CD7F32, transparent 80%);
    }
    
    /* 排名标记 */
    .rank-medal {
      width: 28px;
      height: 28px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      margin-right: 10px;
      font-size: 14px;
      color: white;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.3), transparent) no-repeat;
      background-size: 200% 200%;
      background-position: 0% 0%;
      position: relative;
      z-index: 1;
    }
    
    .rank-medal.gold {
      background-color: #FFD700;
    }
    
    .rank-medal.silver {
      background-color: #C0C0C0;
    }
    
    .rank-medal.bronze {
      background-color: #CD7F32;
    }
    
    .rank-medal.normal {
      background-color: var(--muted-text-light);
      font-size: 13px;
      width: 24px;
      height: 24px;
      margin-right: 12px;
    }
    
    body.dark-theme .rank-medal.normal,
    body.auto-theme.dark-mode .rank-medal.normal {
      background-color: var(--muted-text-dark);
    }
    
    /* 当前用户突出显示 */
    .ios-table-row.current-user {
      background-color: rgba(0, 122, 255, 0.08);
      font-weight: 500;
    }
    
    body.dark-theme .ios-table-row.current-user,
    body.auto-theme.dark-mode .ios-table-row.current-user {
      background-color: rgba(10, 132, 255, 0.15);
    }
    
    /* 无数据提示 */
    .ios-empty-state {
      padding: 40px 20px;
      text-align: center;
      color: var(--muted-text-light);
      font-size: 16px;
      transition: color 0.3s ease;
    }
    
    body.dark-theme .ios-empty-state,
    body.auto-theme.dark-mode .ios-empty-state {
      color: var(--muted-text-dark);
    }
    
    .ios-empty-state i {
      font-size: 40px;
      margin-bottom: 16px;
      opacity: 0.5;
    }
    
    /* 加载动画 */
    .ios-loading {
      display: none;
      padding: 30px;
      text-align: center;
    }
    
    .ios-spinner {
      display: inline-block;
      width: 24px;
      height: 24px;
      border: 2px solid rgba(0, 122, 255, 0.3);
      border-radius: 50%;
      border-top-color: var(--ios-blue-light);
      animation: ios-spin 1s linear infinite;
    }
    
    body.dark-theme .ios-spinner,
    body.auto-theme.dark-mode .ios-spinner {
      border-color: rgba(10, 132, 255, 0.3);
      border-top-color: var(--ios-blue-dark);
    }
    
    @keyframes ios-spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="auto-theme">
<!-- 添加毛玻璃背景 -->
<div class="frosted-glass"></div>

<!-- 添加霓虹灯光效果 -->
<div class="glow-effect glow-blue"></div>
<div class="glow-effect glow-purple"></div>

<!-- 导航栏容器，将由JavaScript加载 -->
<div id="navbar-container"></div>

<!-- Main content starts here -->
<div class="container content-container fade-in-up delay-1">
  <h2 class="ios-section-heading">User Center</h2>
  <div class="row">
    <div class="col-md-12">
      <div class="info-card fade-in-up delay-2">
        <div class="card-body">
          <h5 class="info-title">My School</h5>
          <p class="card-text">Your school is: <span class="info-value" id="userSchool">加载中Loading...</span></p>
          
          <h5 class="info-title">My Region</h5>
          <p class="card-text">You are at: <span class="info-value" id="userLocation">加载中Loading...</span></p>
          
          <h5 class="info-title">My Carbon Credits</h5>
          <p class="card-text">Your current carbon credits balance is: <span class="info-value" id="userPoints">加载中Loading...</span></p>
          
          <h5 class="info-title">My Carbon Reduction (CO₂ in kg)</h5>
          <p class="card-text">You have saved a total of: <span class="info-value" id="userReduction">加载中Loading...</span></p>
          
          <button type="button" class="btn btn-ios-primary float-right ios-float" data-toggle="modal" data-target="#editUserModal">
            <i class="fas fa-user-edit mr-2"></i>Edit My Profile
        </button>
      </div>
          </div>
          </div>
      </div>
  <div class="row mt-3 mb-3 fade-in-up delay-3">
    <div class="col-12 text-right">
      <button type="button" class="history-btn ios-float" id="navigateButton">
        <i class="fas fa-history mr-2"></i>Carbon Reduction History
        </button>
      </div>
          </div>
            </div>

<div class="container content-container fade-in-up delay-4">
  <h2 class="ios-section-heading">Carbon Credits Leaderboards</h2>
  
  <!-- iOS风格分段控制器 -->
  <div class="ios-segment-control">
    <button class="segment active" data-type="all">
      <i class="fas fa-globe-asia"></i>Global
    </button>
    <button class="segment" data-type="local">
      <i class="fas fa-map-marker-alt"></i>Regional
    </button>
    <button class="segment" data-type="school">
      <i class="fas fa-school"></i>School
    </button>
    <div class="segment-selector"></div>
  </div>
  
  <!-- iOS风格卡片表格 -->
  <div class="ios-card-table fade-in-up delay-5">
    <!-- 加载动画 -->
    <div class="ios-loading">
      <div class="ios-spinner"></div>
    </div>
    
    <!-- 排行榜内容区域 -->
    <div id="leaderboard-content">
      <!-- 内容将由JavaScript动态生成 -->
    </div>
  </div>
</div>

<!-- 添加编辑个人资料的模态窗口 -->
<div class="modal fade" id="editUserModal" tabindex="-1" role="dialog" aria-labelledby="editUserModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editUserModalLabel">编辑个人资料 Edit Profile</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="editUserForm">
          <div class="form-group">
            <label for="userCountrySelect">国家/地区 Country/Region</label>
            <select class="form-control" id="userCountrySelect">
              <option value="">加载中 Loading...</option>
            </select>
          </div>
          <div class="form-group">
            <label for="userStateSelect">省份/州 State/Province</label>
            <select class="form-control" id="userStateSelect">
              <option value="">请先选择国家 Please select a country first</option>
            </select>
          </div>
          <div class="form-group">
            <label for="userSchoolSelect">学校 School</label>
            <select class="form-control" id="userSchoolSelect">
              <option value="">加载中 Loading...</option>
            </select>
          </div>
          <div class="form-group" id="userSchoolInputGroup" style="display: none;">
            <label for="userSchoolInput">输入学校名称 Enter School Name</label>
            <input type="text" class="form-control" id="userSchoolInput" placeholder="请输入学校名称 Enter school name">
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">取消 Cancel</button>
            <button type="submit" class="btn btn-ios-primary">保存 Save</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- 主题切换按钮 -->
<div class="theme-toggle" id="themeToggle">
  <i class="fas fa-moon"></i>
</div>

<!-- 复制您主页的页脚 -->
<div id="footer-placeholder"></div>

<script>
  $(document).ready(function() {
    // 主题切换功能
    initThemeToggle();
    
    // 添加按钮点击状态切换
    $('.ios-btn-group .btn').click(function() {
      $('.ios-btn-group .btn').removeClass('active');
      $(this).addClass('active');
    });
    
    // 导航到历史页面
    document.getElementById('navigateButton').addEventListener('click', function () {
      window.location.href = 'pthis.html' // 指定要跳转的页面
    });
    
    // 初始化
    bindRankingButtons();
    switchRanking('all');
    
    var token = localStorage.getItem('token') // 假设用户的 token 存储在 localStorage
    if (token) {
      $.ajax({
        type: 'POST',
        url: 'get_user_points.php', // PHP 文件处理积分获取
        data: { token: token },
        dataType: 'json',
        success: function (response) {
          if (response.success) {
            $('#userPoints').text(response.userPoints) // 设置用户积分
            $('#userReduction').text(response.userPoints / 10)
            $('#userSchool').text(response.school) // 假设你有一个ID为userSchool的元素
            $('#userLocation').text(response.location) // 假设你有一个ID为userLocation的元素
            // 清空排行榜表格
            $('#leaderboard').empty()

// 根据排名获取相应的行的 CSS 类
            function getRowClass(rank) {
              var classes = ['rank-1', 'rank-2', 'rank-3']
              return rank <= 3 ? classes[rank - 1] : ''
            }

// 遍历排行榜数据并添加到表格中
            $.each(response.leaderboard, function (index, user) {
              var rank = index + 1 // 排名是索引加1
              var rankIcon = getRankIcon(rank) // 获取排名图标
              var rowClass = getRowClass(rank) // 获取行的 CSS 类
              var row = $('<tr>').addClass(rowClass).append(
                $('<td>').html(rankIcon),
                $('<td>').text(user.username),
                $('<td>').text(user.points)
              )
              $('#leaderboard').append(row)
            })

            function getRankIcon(rank) {
              var icons = ['<i class="fas fa-crown text-warning"></i>', '<i class="fas fa-medal text-secondary"></i>', '<i class="fas fa-trophy text-success"></i>']
              if (rank <= 3) {
                return icons[rank - 1] + ' ' + rank // 前三名使用特殊图标
              }
              return rank // 其他排名只显示数字
            }
          } else {
            $('#userPoints').text('无法加载积分')
            alert('获取积分失败: ' + response.error)
          }
        },
        error: function (jqXHR, textStatus, errorThrown) {
          console.log('服务器响应内容:', jqXHR.responseText) // 打印服务器响应内容
          $('#userPoints').text('无法加载积分')
          alert('请求积分数据失败，请稍后再试。错误信息：' + textStatus)
        },
      })
    } else {
      $('#userPoints').text('未登录')
      alert('请先登录。')
      window.location.href = 'index.html'
    }
    
    // 加载国家和学校数据
    loadCountries()
    loadSchools()

    // 监听学校选择框的变化
    $('#userSchoolSelect').change(function () {
      if ($(this).val() == 'other') {
        $('#userSchoolInputGroup').show()
      } else {
        $('#userSchoolInputGroup').hide()
      }
    })

    // 监听表单提交事件
    $('#editUserForm').submit(function (e) {
      e.preventDefault()
      var school = $('#userSchoolSelect').val()
      var schoolName = '' // 用于存储学校名称
      var isNewSchool = false

      // 检查用户是否选择了"其他"选项
      if (school === 'other') {
        schoolName = $('#userSchoolInput').val() // 从输入框获取学校名称
        isNewSchool = true
      } else {
        // 从下拉列表中获取学校名称
        schoolName = $('#userSchoolSelect option:selected').text()
      }
      if (schoolName == '请选择学校Select school') {
        schoolName = undefined
      }
      var state = $('#userStateSelect').val()
      var isNewSchool = $('#userSchoolSelect').val() == 'other'
      var token = localStorage.getItem('token')
      // 提交数据到后端
      $.ajax({
        type: 'POST',
        url: 'edit_user_info.php',
        data: {
          token: token,
          school: schoolName ? schoolName : undefined,
          state: state ? state : undefined,
          new_sch: isNewSchool,
        },
        success: function (response) {
          // 处理响应
          alert('信息更新成功！')
          $('#editUserModal').modal('hide')
        },
        error: function (error) {
          alert('信息更新错误：' + error)
        },
      })
    })
  });

  // 主题切换功能初始化
  function initThemeToggle() {
    const body = document.body;
    const themeToggle = document.getElementById('themeToggle');
    const icon = themeToggle.querySelector('i');
    
    // 检查用户是否有保存的偏好
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) {
      body.className = savedTheme;
      updateThemeIcon(savedTheme);
    } else {
      body.classList.add('auto-theme');
      if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        body.classList.add('dark-mode');
      }
      updateThemeIcon('auto-theme');
    }
    
    // 监听系统暗模式变化
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
      if (body.classList.contains('auto-theme')) {
        if (e.matches) {
          body.classList.add('dark-mode');
        } else {
          body.classList.remove('dark-mode');
        }
        updateThemeIcon('auto-theme');
      }
    });
    
    // 为主题切换按钮添加点击事件
    themeToggle.addEventListener('click', function() {
      if (body.classList.contains('auto-theme')) {
        body.classList.remove('auto-theme');
        body.classList.remove('dark-mode');
        body.classList.add('dark-theme');
        localStorage.setItem('theme', 'dark-theme');
      } else if (body.classList.contains('dark-theme')) {
        body.classList.remove('dark-theme');
        body.classList.add('light-theme');
        localStorage.setItem('theme', 'light-theme');
      } else {
        body.classList.remove('light-theme');
        body.classList.add('auto-theme');
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
          body.classList.add('dark-mode');
        }
        localStorage.setItem('theme', 'auto-theme');
      }
      updateThemeIcon(body.className);
    });
  }
  
  // 更新主题图标
  function updateThemeIcon(theme) {
    const icon = document.querySelector('#themeToggle i');
    if (!icon) return;
    
    if (theme.includes('dark-theme')) {
      icon.className = 'fas fa-sun';
    } else if (theme.includes('light-theme')) {
      icon.className = 'fas fa-moon';
    } else {
      // 自动主题
      if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        icon.className = 'fas fa-sun';
      } else {
        icon.className = 'fas fa-moon';
      }
    }
  }

  function logout() {
    localStorage.removeItem('token') // 确保移除正确的 localStorage 项
    // 更新UI为未登录状态
    $('#userStatus').text('')
    $('#logoutButton').hide()
    $('#loginButton').show()
    Redirect('index.html')
  }

  function Redirect(webpage) {
    window.location = webpage
  }

  // Step 1: Load countries into the country select element
  function loadCountries() {
    fetch('./countries.json')
      .then(response => response.json())
      .then(data => {
        const countrySelect = document.getElementById('userCountrySelect')
        if (countrySelect) {
        countrySelect.innerHTML = '' // 清空现有选项
        data.forEach(country => {
          const option = document.createElement('option')
          option.value = country.code
          option.textContent = country.name
          countrySelect.appendChild(option)
        })
        } else {
          console.log('userCountrySelect element not found')
        }
      })
      .catch(error => console.error('Error loading countries:', error))
  }

  // Step 2: Listen for changes on the country select element
  $(document).ready(function() {
    $(document).on('change', '#userCountrySelect', function() {
    const selectedCountryCode = this.value
    updateStates(selectedCountryCode)
    })
  })

  // Step 3: Populate states/provinces based on the selected country
  function updateStates(countryCode) {
    fetch('./countries.json')
      .then(response => response.json())
      .then(data => {
        const statesSelect = document.getElementById('userStateSelect')
        if (statesSelect) {
        statesSelect.innerHTML = '' // Clear current states/provinces
        const selectedCountry = data.find(country => country.code === countryCode)
        if (selectedCountry && selectedCountry.states) {
          selectedCountry.states.forEach(state => {
            const option = document.createElement('option')
            option.value = state.code
            option.textContent = state.name
            statesSelect.appendChild(option)
          })
          }
        } else {
          console.log('userStateSelect element not found')
        }
      })
      .catch(error => console.error('Error updating states:', error))
  }


  function loadSchools() {
    // 从 localStorage 获取 token
    var token = localStorage.getItem('token')

    // 向后端发送请求，获取学校列表
    $.ajax({
      url: 'get_schools.php', // 假设您的后端接口URL是这个
      type: 'POST',
      dataType: 'json',
      data: { token: token }, // 将 token 作为请求参数发送
      success: function (data) {
        var schoolSelect = document.getElementById('userSchoolSelect')
        if (schoolSelect) {
        var schoolOptions = '<option value="">请选择学校Select school</option>'
        $.each(data, function (index, school) {
          schoolOptions += '<option value="' + school.id + '">' + school.name + '</option>'
        })
          schoolOptions += '<option value="other">其他Other（自行输入Enter new）</option>' // 添加一个"其他"选项
        $('#userSchoolSelect').html(schoolOptions)
        } else {
          console.log('userSchoolSelect element not found')
        }
      },
      error: function (xhr, status, error) {
        console.log('加载学校列表失败: ', error)
      },
    })
  }

  // 切换排行榜类型的事件处理函数
  function switchRanking(type) {
    console.log('切换排行榜类型:', type);
    
    // 显示加载动画
    $('#leaderboard-content').hide();
    $('.ios-loading').show();
    
    var token = localStorage.getItem('token')
    var userLocation = $('#userLocation').text().trim();
    var userSchool = $('#userSchool').text().trim();
    var data = {
      token: token,
      type: type,
    }

    // 根据排行榜类型，设置请求参数
    if (type === 'local') {
      data.location = userLocation
    } else if (type === 'school') {
      data.school = userSchool
    }

    // 向后端发送请求，获取排行榜数据
    $.ajax({
      url: 'get_rank.php',
      type: 'POST',
      dataType: 'json',
      data: data,
      success: function (response) {
        // 隐藏加载动画
        $('.ios-loading').hide();
        $('#leaderboard-content').show();
        
        if (response.success) {
          // 清空现有排行榜
          $('#leaderboard-content').empty();
          
          if (response.ranking && response.ranking.length > 0) {
            // 添加表格头部
            const tableHeader = $('<div class="ios-table-header">').append(
              $('<div class="col-rank">').text('Rank'),
              $('<div class="col-user">').text('Username'),
              $('<div class="col-points">').text('Credits')
            );
            $('#leaderboard-content').append(tableHeader);
            
            var currentUsername = localStorage.getItem('username');
            
            // 遍历排行榜数据并添加到表格中
            $.each(response.ranking, function (index, user) {
              var rank = index + 1;
              var rankClass = '';
              var rankHtml = '';
              
              if (rank <= 3) {
                rankClass = 'top-rank rank-' + rank;
                
                // 使用iOS风格徽章而不是图标
                if (rank === 1) {
                  rankHtml = '<div class="rank-medal gold"><i class="fas fa-trophy"></i></div>';
                } else if (rank === 2) {
                  rankHtml = '<div class="rank-medal silver"><i class="fas fa-medal"></i></div>';
                } else {
                  rankHtml = '<div class="rank-medal bronze"><i class="fas fa-award"></i></div>';
                }
              } else {
                rankHtml = '<div class="rank-medal normal">' + rank + '</div>';
              }
              
              // 如果是当前用户，添加高亮类
              if (user.username === currentUsername) {
                rankClass += ' current-user';
              }
              
              // 创建行元素
              const row = $('<div class="ios-table-row ' + rankClass + '">').append(
                $('<div class="col-rank">').html(rankHtml),
                $('<div class="col-user">').text(user.username),
                $('<div class="col-points">').text(user.points)
              );
              
              $('#leaderboard-content').append(row);
            });
          } else {
            // 显示无数据状态
            const emptyState = $('<div class="ios-empty-state">').append(
              $('<i class="fas fa-trophy"></i>'),
              $('<p>').text('No ranking data available.')
            );
            $('#leaderboard-content').append(emptyState);
          }
        } else {
          // 显示错误信息
          const errorState = $('<div class="ios-empty-state">').append(
            $('<i class="fas fa-exclamation-circle"></i>'),
            $('<p>').text('Failed to load ranking data: ' + (response.error || 'Unknown error'))
          );
          $('#leaderboard-content').append(errorState);
        }
      },
      error: function () {
        // 隐藏加载动画
        $('.ios-loading').hide();
        $('#leaderboard-content').show();
        
        // 显示错误信息
        const errorState = $('<div class="ios-empty-state">').append(
          $('<i class="fas fa-exclamation-circle"></i>'),
          $('<p>').text('Failed to connect to the server. Please try again later.')
        );
        $('#leaderboard-content').append(errorState);
      },
    });
  }

  function bindRankingButtons() {
    $('.ios-segment-control .segment').off('click');
    
    $('.ios-segment-control .segment').on('click', function() {
      const type = $(this).data('type');
      
      // 更新active状态
      $('.ios-segment-control .segment').removeClass('active');
      $(this).addClass('active');
      
      // 更新选择器位置
      const index = $(this).index();
      const totalSegments = $('.ios-segment-control .segment').length;
      updateSelectorPosition($('.segment-selector')[0], index, totalSegments);
      
      // 加载对应排行榜
      if (type === 'local') {
        var userLocation = $('#userLocation').text().trim();
        if (!userLocation) {
          showIosAlert('用户地区信息未加载，请稍后再试。');
          return;
        }
      }
      
      switchRanking(type);
    });
  }
  
  // iOS风格提示框
  function showIosAlert(message) {
    // 创建iOS风格的提示框
    const alertDiv = $('<div>').addClass('ios-alert')
      .css({
        'position': 'fixed',
        'bottom': '20%',
        'left': '50%',
        'transform': 'translateX(-50%)',
        'background-color': 'rgba(60, 60, 67, 0.7)',
        'color': 'white',
        'padding': '12px 20px',
        'border-radius': '8px',
        'max-width': '80%',
        'text-align': 'center',
        'z-index': '9999',
        'font-size': '15px',
        'opacity': '0',
        'transition': 'opacity 0.2s ease'
      })
      .text(message);
    
    // 添加到页面
    $('body').append(alertDiv);
    
    // 显示提示框
    setTimeout(() => {
      alertDiv.css('opacity', '1');
    }, 10);
    
    // 3秒后淡出并移除
    setTimeout(() => {
      alertDiv.css('opacity', '0');
      setTimeout(() => {
        alertDiv.remove();
      }, 300);
    }, 3000);
  }
</script>
</body>
</html>
